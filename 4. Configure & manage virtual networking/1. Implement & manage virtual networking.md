# Azure Virtual Networks (VNets) Overview

Azure Virtual Networks (VNets) are the foundation of Azure networking. They allow you to define a private network space, divide it into subnets, and control network traffic using **Network Security Groups (NSGs)** and **user-defined routes (UDRs)**.

---

## Key Concepts

| Concept              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **VNet**             | A private network in Azure with one or more IP address ranges (CIDR blocks). |
| **Subnet**           | A segment of a VNet’s IP space, used to isolate resources and control traffic. |
| **CIDR Notation**    | Defines IP ranges (e.g., `10.0.0.0/16`).                                    |
| **Private IP Ranges** | Defined by RFC 1918: `10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/16`.      |
| **Reserved IP Ranges** | Cannot be used: `169.254.0.0/16`, `168.63.129.16/32`.                     |

---

## Steps to Create and Configure a VNet

1. **Define VNet IP Range:**
   - Use CIDR notation (e.g., `10.0.0.0/16`).
   - Avoid overlapping with other VNets or on-premises networks.
2. **Create Subnets:**
   - Divide the VNet into subnets (e.g., `10.0.1.0/24` for web tier).
   - Subnets must be within the VNet’s IP range.
3. **Add Resources:**
   - Deploy VMs, load balancers, and other resources into subnets.
4. **Configure Network Security:**
   - Use NSGs to control inbound/outbound traffic.
   - Use UDRs to define custom routing.

---

## Key Takeaways

| Aspect              | Details                                                                 |
|---------------------|-------------------------------------------------------------------------|
| **VNet IP Range**   | Must use private IP ranges (RFC 1918).                                  |
| **Subnet Configuration** | Subnets must be within the VNet’s IP range and cannot overlap.      |
| **Reserved IPs**    | Azure reserves the first and last IPs in each subnet.                  |
| **Subnet Changes**  | Cannot change subnet IP range if resources are deployed.               |
| **Subnet Deletion** | Subnets can only be deleted if they are empty.                         |

---

## Visual Representation

### VNet and Subnet Structure

| VNet            | Subnets               | IP Range                     |
|-----------------|-----------------------|------------------------------|
| `10.0.0.0/16`   | Web Tier (`10.0.1.0/24`) | `10.0.1.0–10.0.1.255`       |
|                 | App Tier (`10.0.2.0/24`) | `10.0.2.0–10.0.2.255`       |
|                 | DB Tier (`10.0.3.0/24`)  | `10.0.3.0–10.0.3.255`       |

### Reserved IPs in Subnets

| Subnet            | Reserved IPs                          |
|-------------------|---------------------------------------|
| `10.0.1.0/24`     | `10.0.1.0` (Network ID), `10.0.1.255` (Broadcast). |

---

## Best Practices

- **Plan IP Ranges Carefully:**
  - Avoid overlaps with other VNets or on-premises networks.
- **Use Subnets for Isolation:**
  - Separate application tiers (e.g., web, app, DB) into different subnets.
- **Leverage NSGs and UDRs:**
  - Control traffic flow and enhance security using NSGs and UDRs.
- **Reserve IP Space for Future Use:**
  - Leave unused IP space in the VNet for future subnets.
 
---

# Additional Virtual Network (VNet) and Subnet Settings

Beyond IP address ranges, VNets and subnets have additional settings that enhance functionality, security, and connectivity.

---

## Key VNet Settings

| Property          | Description                                                                 |
|-------------------|-----------------------------------------------------------------------------|
| **Name**          | Unique within the resource group (2–64 characters; letters, numbers, underscores, periods, hyphens). |
| **Location**      | The Azure region where the VNet is deployed.                                |
| **Address Space** | Array of IP address ranges (CIDR notation) available for subnets.           |
| **DNS Settings**  | Custom DNS servers for the VNet (overrides Azure-provided DNS).             |
| **Subnets**       | List of subnets within the VNet.                                            |
| **Peerings**      | List of VNet peerings for connecting to other VNets.                        |

---

## Key Subnet Settings

| Property                  | Description                                                                 |
|---------------------------|-----------------------------------------------------------------------------|
| **Name**                  | Unique within the VNet (2–80 characters; letters, numbers, underscores, periods, hyphens). |
| **Address Range**         | IP address range (CIDR notation) within the VNet’s address space.           |
| **Network Security Group (NSG)** | Controls inbound/outbound traffic for the subnet.                     |
| **Route Table**           | Overrides default system routes for custom routing.                         |
| **Service Endpoints**     | Provides direct, secure access to Azure PaaS services (e.g., Azure Storage). |
| **Delegations**           | Allows subnets to be used by specific Azure services (e.g., Azure SQL Managed Instance). |

---

## Key Takeaways

| Aspect              | Details                                                                 |
|---------------------|-------------------------------------------------------------------------|
| **VNet Name**       | Must be unique within the resource group.                               |
| **Subnet Name**     | Must be unique within the VNet.                                         |
| **DNS Settings**    | Custom DNS servers can be configured for the VNet.                      |
| **NSGs**            | Control traffic flow for subnets.                                       |
| **Service Endpoints** | Enable secure access to Azure PaaS services.                          |
| **Delegations**     | Allow subnets to host managed Azure services.                           |

---

## Best Practices

- **Use Custom DNS:**
  - Configure custom DNS servers for specific domain resolution needs.
- **Leverage NSGs:**
  - Apply NSGs to subnets for granular traffic control.
- **Enable Service Endpoints:**
  - Use service endpoints for secure, private access to Azure PaaS services.
- **Plan Subnet Delegations:**
  - Delegate subnets to Azure services for managed resource deployment.
 
---

# Steps to Create a Virtual Network (VNet) and Subnets

Creating a VNet and subnets in Azure involves defining the network’s IP address space, subnets, and additional settings like security and service endpoints.

---

## Key Steps

### 1. Create a Virtual Network
1. **Navigate to Azure Portal:**
   - Click **Create a Resource → Networking → Virtual Network**.
2. **Configure Basics:**
   - **Subscription:** Select the subscription.
   - **Resource Group:** Choose or create a resource group.
   - **Name:** Provide a unique name for the VNet.
   - **Region:** Select the Azure region.
3. **Define IP Address Space:**
   - Specify the VNet’s IP address range in CIDR notation (e.g., `10.0.0.0/16`).
4. **Add Subnets:**
   - Define the first subnet (e.g., `10.0.1.0/24`).
   - Optionally, add more subnets during creation.
5. **Configure Additional Settings:**
   - Enable **Bastion Host**, **DDoS Protection**, or **Azure Firewall** if needed.
6. **Review and Create:**
   - Review the configuration and click **Create**.

### 2. Add Subnets to an Existing VNet
1. **Navigate to the VNet:**
   - Open the VNet in the Azure portal.
2. **Add a Subnet:**
   - Click **+ Subnet** and provide:
     - **Name:** Unique within the VNet.
     - **Address Range:** CIDR block within the VNet’s IP range.
     - **NAT Gateway:** Optional.
     - **Network Security Group (NSG):** Optional.
     - **Route Table:** Optional.
     - **Service Endpoints:** Optional.
     - **Subnet Delegation:** Optional.
3. **Save Configuration:**
   - Click **OK** to add the subnet.

---

## Key Takeaways

| Step                  | Details                                                                 |
|-----------------------|-------------------------------------------------------------------------|
| **VNet Creation**     | Define subscription, resource group, name, region, and IP address space. |
| **Subnet Creation**   | Specify name, address range, and optional settings (NSG, route table, etc.). |
| **Additional Settings** | Enable Bastion Host, DDoS Protection, or Azure Firewall.              |
| **Subnet Configuration** | Add subnets to an existing VNet with optional features like service endpoints. |

---

# VNet Peering Overview

VNet peering enables direct communication between virtual machines (VMs) in two Azure Virtual Networks (VNets) using private IP addresses. It can be:

- **Regional Peering:** Between VNets in the same Azure region.
- **Global Peering:** Between VNets in different Azure regions.

---

## Key Features

| Feature              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Direct Connectivity** | VMs in peered VNets communicate directly over Microsoft’s backbone network. |
| **No Overlapping IPs** | Peered VNets must have non-overlapping IP address spaces.                   |
| **No VNet Gateways** | No need for VPN gateways, reducing cost and complexity.                     |
| **Global Peering**   | Connects VNets across different Azure regions.                              |
| **Transitive Peering** | Peering is not transitive (e.g., VNetA ↔ VNetB and VNetB ↔ VNetC does not imply VNetA ↔ VNetC). |

---

## Steps to Configure VNet Peering

1. **Navigate to Azure Portal:**
   - Open the first VNet and click **Peerings**.
2. **Add Peering:**
   - Click **+ Add** and provide:
     - **Name:** Unique name for the peering.
     - **Remote VNet:** Select the second VNet (in the same or different region).
     - **Allow Virtual Network Access:** Enable for full connectivity.
3. **Configure Remote Peering:**
   - Repeat the process on the second VNet to establish bidirectional peering.
4. **Verify Peering:**
   - Check the peering status in both VNets.

---

## Key Takeaways

| Aspect              | Details                                                                 |
|---------------------|-------------------------------------------------------------------------|
| **IP Address Space** | Peered VNets must have non-overlapping IP ranges.                       |
| **Connectivity**    | VMs in peered VNets can communicate directly using private IPs.         |
| **Global Peering**  | Connects VNets across different Azure regions.                          |
| **Transitive Peering** | Peering is not transitive; each pair must be explicitly peered.       |
| **Limitations**     | - Max 500 peering connections per VNet.                                 |
|                     | - Basic Load Balancer front-end IPs are not accessible across regions.  |

---

# Hub-and-Spoke Network Topology

A hub-and-spoke architecture centralizes shared resources (e.g., DNS servers, domain controllers) in a **hub VNet**, while application workloads are deployed in separate **spoke VNets**. This reduces duplication and simplifies management.

---

## Key Concepts

| Concept              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Hub VNet**         | Central VNet hosting shared services (e.g., firewalls, gateways).           |
| **Spoke VNets**      | Separate VNets for individual applications or workloads.                    |
| **Service Chaining** | Routes traffic between spokes through a Network Virtual Appliance (NVA) in the hub. |
| **VNet Peering**     | Connects hub and spokes; not transitive by default.                         |
| **User-Defined Routes (UDRs)** | Directs traffic between spokes via the hub.                     |

---

## Service Chaining

Service chaining enables communication between spoke VNets by routing traffic through an NVA (e.g., firewall, router) in the hub VNet. This avoids the need for direct peering between spokes.

### Steps to Configure Service Chaining
1. **Deploy NVA in Hub:**
   - Install a network virtual appliance (e.g., firewall) in the hub VNet.
2. **Configure UDRs:**
   - Create UDRs in each spoke VNet to route traffic to the NVA.
3. **Enable Forwarded Traffic:**
   - In VNet peering settings, enable **Allow Forwarded Traffic** for hub-spoke peerings.

---

## Sharing Virtual Network Gateways

A single virtual network gateway in the hub VNet can be shared by all spoke VNets for external connectivity (e.g., VPN, ExpressRoute).

### Steps to Share a Gateway
1. **Deploy Gateway in Hub:**
   - Create a virtual network gateway in the hub VNet.
2. **Configure Peering:**
   - Enable **Use Remote Gateways** on spoke-to-hub peering.
   - Enable **Allow Gateway Transit** on hub-to-spoke peering.
3. **Verify Connectivity:**
   - Ensure spokes can access external networks via the hub gateway.

---

## Key Takeaways

| Aspect              | Details                                                                 |
|---------------------|-------------------------------------------------------------------------|
| **Hub-and-Spoke**   | Centralizes shared resources in a hub VNet.                             |
| **Service Chaining**| Routes traffic between spokes via an NVA in the hub.                    |
| **UDRs**            | Direct traffic between spokes using the hub.                            |
| **Shared Gateway**  | Spokes share a single virtual network gateway in the hub.               |
| **Peering Settings**| Enable **Allow Forwarded Traffic** and **Allow Gateway Transit**.       |

---

# Steps to Create VNet Peering

VNet peering allows direct communication between two Azure Virtual Networks (VNets) using private IP addresses. Follow these steps to create a peering connection:

---

## Key Steps

1. **Navigate to Azure Portal:**
   - Open the first VNet (e.g., **VNet1**) and click **Peerings** under **Settings**.
2. **Add Peering:**
   - Click **+ Add** to open the **Add Peering** blade.
3. **Configure Peering Details:**
   - **Name:** Provide a name for the peering (e.g., `VNet1-to-VNet2`).
4. **Peer Details:**
   - Select **Resource Manager** (or **Classic** if applicable).
   - Choose the **Subscription** and **Virtual Network** for the second VNet (e.g., **VNet2**).
   - **Name of Peering from VNet2 to VNet1:** Set a name (e.g., `VNet2-to-VNet1`).
5. **Set Virtual Network Access:**
   - Enable **Allow Virtual Network Access** for both directions:
     - From **VNet1** to **VNet2**.
     - From **VNet2** to **VNet1**.
6. **Configure Forwarded Traffic:**
   - Disable **Allow Forwarded Traffic** for both directions (unless required for service chaining).
7. **Gateway Transit:**
   - Leave **Allow Gateway Transit** unselected (unless sharing a gateway).
8. **Create Peering:**
   - Click **OK** to create the peering.
  
---

# Network Interfaces (NICs)

A Network Interface (NIC) is an Azure resource that provides network connectivity for virtual machines (VMs). It can have both private and public IP addresses.

---

## Key Features

| Feature              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Private IP Address** | Used for communication within Azure VNets and on-premises networks.        |
| **Public IP Address** | Used for communication with the Internet.                                   |
| **Multiple NICs**    | A VM can have multiple NICs for advanced networking scenarios.              |
| **IP Forwarding**    | Allows a VM to receive/send traffic not destined for its own IP.            |
| **Accelerated Networking** | Improves network performance (supported on specific VM sizes).         |

---

## Private IP Addresses

Private IP addresses are assigned to NICs and are used for internal communication.

### Allocation Methods

| Method              | Description                                                                 |
|---------------------|-----------------------------------------------------------------------------|
| **Dynamic**         | Automatically assigned by Azure DHCP (default).                             |
| **Static**          | Manually assigned and remains fixed.                                        |

### Key Points
- **Dynamic IPs** can change when a VM is stopped/started.
- **Static IPs** are used for:
  - Domain controllers, DNS servers.
  - Resources requiring firewall rules.
  - Resources accessed by IP address (not DNS).

---

## Steps to Configure a NIC

1. **Create a NIC:**
   - In the Azure portal, navigate to **Network Interfaces → + Add**.
   - Provide a **Name**, select the **VNet** and **Subnet**.
2. **Configure IP Addresses:**
   - Add **Private IP Addresses** (dynamic or static).
   - Optionally, associate a **Public IP Address**.
3. **Enable Advanced Features:**
   - **IP Forwarding:** Enable if the VM will act as a router or firewall.
   - **Accelerated Networking:** Enable for improved performance (if supported).
  
---

# Static Private IP Addresses

Static private IP addresses are manually assigned to a VM’s network interface (NIC) and remain fixed, even after the VM is stopped/started.

---

## Steps to Enable Static Private IP Address

1. **Navigate to Azure Portal:**
   - Open the VM’s **Network Interface (NIC)**.
2. **Modify IP Configuration:**
   - Click **IP Configurations → Select the IP configuration** to update.
3. **Set Allocation Method:**
   - Change **Private IP Address Allocation** to **Static**.
   - Specify the desired IP address.
4. **Save Changes:**
   - Click **Save** to apply the static IP.

---

# Public IP Addresses

Public IP addresses allow VMs to communicate with the Internet. They are standalone Azure resources and can be associated with NICs, load balancers, or other services.

---

## Key Features

| Feature              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Basic Tier**       | Supports dynamic and static allocation; open by default for inbound traffic. |
| **Standard Tier**    | Supports static allocation only; closed by default for inbound traffic.     |
| **Zone Redundancy**  | Standard tier supports availability zones for high availability.            |
| **Public IP Prefixes** | Reserve a contiguous block of IP addresses (Standard tier only).          |

---

## Steps to Create and Configure Public IP Addresses

1. **Create Public IP Address:**
   - Navigate to **Public IP Addresses → + Add**.
   - Provide a **Name**, select the **Tier** (Basic or Standard), and choose **Allocation Method** (Static or Dynamic).
2. **Associate with NIC:**
   - Open the VM’s **Network Interface → IP Configurations**.
   - Add or update the IP configuration to reference the public IP address.
3. **Use Public IP Prefixes (Optional):**
   - Create a **Public IP Prefix** to reserve a block of IP addresses.
   - Assign individual IPs from the prefix to resources.
  
---

# DNS Labels Overview

DNS labels map domain names to IP addresses, allowing users to access resources using a friendly name instead of an IP address. Azure provides multiple ways to configure DNS labels for public IP addresses.

---

## Key Methods to Configure DNS Labels

| Method                  | Description                                                                 |
|-------------------------|-----------------------------------------------------------------------------|
| **DNS Name Label Property** | Specify a label in the public IP address resource (e.g., `contoso-app`). |
| **DNS A Record**        | Create an A record in Azure DNS or a third-party DNS service.               |
| **DNS CNAME Record**    | Create a CNAME record in Azure DNS or a third-party DNS service.            |
| **Alias Record**        | Create an alias record in Azure DNS (automatically updates with IP changes). |

---

## Steps to Configure DNS Labels

### 1. DNS Name Label Property
1. **Navigate to Azure Portal:**
   - Open the **Public IP Address** resource.
2. **Configure DNS Label:**
   - Under **Settings**, click **Configuration**.
   - Enter a **DNS Name Label** (e.g., `contoso-app`).
3. **Save Changes:**
   - The FQDN will be `<label>.<region>.cloudapp.azure.com` (e.g., `contoso-app.centralus.cloudapp.azure.com`).

### 2. DNS A Record
1. **Host Vanity Domain:**
   - Use Azure DNS or a third-party DNS service.
2. **Create A Record:**
   - Map a domain name (e.g., `app.contoso.com`) to the public IP address.
3. **Update Record:**
   - Manually update the A record if the IP changes (use static IP to avoid this).

### 3. DNS CNAME Record
1. **Host Vanity Domain:**
   - Use Azure DNS or a third-party DNS service.
2. **Create CNAME Record:**
   - Map a domain name (e.g., `www.contoso.com`) to the Azure-provided FQDN (e.g., `contoso-app.centralus.cloudapp.azure.com`).
3. **Limitation:**
   - Cannot create a CNAME record for the root domain (e.g., `contoso.com`).

### 4. Alias Record (Azure DNS Only)
1. **Host Vanity Domain in Azure DNS:**
   - Ensure the domain is hosted in Azure DNS.
2. **Create Alias Record:**
   - Map a domain name (e.g., `app.contoso.com`) to the public IP address resource.
3. **Automatic Updates:**
   - The alias record updates automatically if the IP changes.

---

## Key Takeaways

| Method                  | Pros                                      | Cons                                      |
|-------------------------|------------------------------------------|------------------------------------------|
| **DNS Name Label**      | Simple; no external DNS required.        | Limited to Azure-provided domain.        |
| **DNS A Record**        | Works with any DNS service.              | Requires manual updates if IP changes.   |
| **DNS CNAME Record**    | Automatically updates with IP changes.   | Cannot be used for root domains.         |
| **Alias Record**        | Automatically updates; supports root domains. | Requires Azure DNS.                  |

---

## Visual Representation

### DNS Label Configuration Workflow
1. **DNS Name Label:**
   - Public IP → Configuration → Enter DNS Label.
2. **DNS A Record:**
   - Create A record in DNS (e.g., `app.contoso.com` → Public IP).
3. **DNS CNAME Record:**
   - Create CNAME record in DNS (e.g., `www.contoso.com` → Azure FQDN).
4. **Alias Record:**
   - Create alias record in Azure DNS (e.g., `app.contoso.com` → Public IP resource).

### Example DNS Labels

| Method                  | Example                                                                 |
|-------------------------|-------------------------------------------------------------------------|
| **DNS Name Label**      | `contoso-app.centralus.cloudapp.azure.com`                              |
| **DNS A Record**        | `app.contoso.com` → `20.185.10.45`                                      |
| **DNS CNAME Record**    | `www.contoso.com` → `contoso-app.centralus.cloudapp.azure.com`          |
| **Alias Record**        | `app.contoso.com` → Public IP Resource                                  |

---

# Outbound Internet Connections

Azure VMs can connect to the Internet using **public IP addresses** or **Source Network Address Translation (SNAT)**.

---

## Key Concepts

| Concept              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Public IP Address** | Outbound traffic uses the public IP as the source IP.                       |
| **SNAT**             | Maps private IPs to an Internet-facing IP for outbound traffic.             |
| **IPv4 and IPv6**    | Public IPs support IPv4 or IPv6 (Basic tier only; IPv6 is dynamic only).    |

---

## Steps to Create a Public IP Address

1. **Navigate to Azure Portal:**
   - Click **Create a Resource → Search for Public IP Address**.
2. **Configure Settings:**
   - **Name:** Provide a unique name.
   - **SKU:** Choose **Basic** or **Standard**.
   - **DNS Name Label:** Optional (e.g., `contoso-app`).
   - **IP Version:** IPv4 or IPv6 (Basic tier only).
   - **Assignment:** Static or Dynamic (Basic tier only).
   - **Location:** Same region as the resource using the IP.
3. **Create:**
   - Click **Create** to provision the public IP.

---

## Network Routes

Azure uses **system routes** to automatically route traffic within and between VNets, to the Internet, and to on-premises networks.

### Key System Routes

| Route                | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Same Subnet**      | Traffic within the same subnet.                                             |
| **Different Subnets**| Traffic between subnets in the same VNet.                                   |
| **Internet**         | Outbound traffic to the Internet.                                           |
| **VNet-to-VNet**     | Traffic between VNets via VPN gateway or VNet peering.                      |
| **On-Premises**      | Traffic to on-premises networks via VPN gateway or ExpressRoute.            |
| **Service Endpoints**| Traffic to Azure PaaS services (e.g., Azure Storage, SQL).                  |

---

## Key Takeaways

| Aspect              | Details                                                                 |
|---------------------|-------------------------------------------------------------------------|
| **Outbound Traffic**| Uses public IP or SNAT for Internet access.                             |
| **Public IP Creation** | Configure name, SKU, DNS label, IP version, and assignment.          |
| **System Routes**   | Automatically handle traffic within VNets, to the Internet, and on-premises. |
| **Custom Routes**   | Use User-Defined Routes (UDRs) for advanced routing scenarios.          |

---

## Visual Representation

### Outbound Traffic Workflow
1. **VM with Public IP:**
   - Outbound traffic uses the public IP as the source.
2. **VM without Public IP:**
   - Outbound traffic uses SNAT to map private IP to an Internet-facing IP.

### System Routes

| Source               | Destination               | Route Type                          |
|----------------------|---------------------------|-------------------------------------|
| **Subnet A**         | Subnet B (same VNet)      | Intra-VNet.                         |
| **VNet**             | Internet                  | Internet.                           |
| **VNet**             | On-Premises               | VPN/ExpressRoute.                   |
| **VNet**             | Azure PaaS Services       | Service Endpoints.                  |

---

## Best Practices

- **Use Public IPs for Direct Internet Access:**
  - Assign public IPs to VMs requiring direct Internet connectivity.
- **Leverage SNAT for Cost Efficiency:**
  - Use SNAT for outbound traffic when public IPs are not required.
- **Understand System Routes:**
  - Use default system routes for common scenarios (e.g., intra-VNet, Internet).
- **Use UDRs for Advanced Routing:**
  - Define custom routes for specific traffic patterns (e.g., NVAs).
 
---

# User-Defined Routes (UDRs) Overview

UDRs allow you to customize network traffic routing in Azure by overriding default system routes. They are commonly used to route traffic through **Network Virtual Appliances (NVAs)** like firewalls, routers, or load balancers.

---

## Key Concepts

| Concept              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Route Table**      | A resource containing custom routing rules.                                 |
| **Next Hop Types**   | Defines where traffic is routed (e.g., virtual appliance, VPN gateway).     |
| **Subnet Association** | Route tables are associated with subnets to apply routing rules.          |
| **Routing Loop Prevention** | Avoid applying route tables to subnets containing the next hop address. |

---

## Steps to Configure UDRs

1. **Create a Route Table:**
   - Navigate to **Route Tables → + Add**.
   - Provide a **Name**, select the **Subscription**, **Resource Group**, and **Region**.
2. **Add Routes:**
   - Open the route table → Click **Routes → + Add**.
   - Specify:
     - **Name:** Unique name for the route.
     - **Address Prefix:** Destination IP range (CIDR notation).
     - **Next Hop Type:** Choose from:
       - **Virtual Appliance:** IP address of the NVA.
       - **Virtual Network Gateway:** For VPN gateways.
       - **Virtual Network:** For intra-VNet routing.
       - **Internet:** For Internet-bound traffic.
       - **None:** To drop traffic.
3. **Associate Route Table with Subnet:**
   - Open the **Subnet → Click Route Table → Select the route table**.
4. **Verify Routing:**
   - Ensure traffic is routed according to the UDR rules.

---

## Key Takeaways

| Aspect              | Details                                                                 |
|---------------------|-------------------------------------------------------------------------|
| **Route Table**     | Contains custom routing rules.                                          |
| **Next Hop Types**  | Virtual Appliance, Virtual Network Gateway, Virtual Network, Internet, None. |
| **Subnet Association** | Apply route tables to subnets for custom routing.                    |
| **Routing Loop Prevention** | Avoid applying route tables to subnets containing the next hop address. |

---

## Visual Representation

### UDR Configuration Workflow
1. **Create Route Table:**
   - Name, Subscription, Resource Group, Region.
2. **Add Routes:**
   - Name, Address Prefix, Next Hop Type.
3. **Associate with Subnet:**
   - Apply route table to the desired subnet.
4. **Verify Routing:**
   - Ensure traffic flows as expected.

### Example UDR Rules

| Name          | Address Prefix   | Next Hop Type        | Next Hop IP        |
|---------------|------------------|----------------------|--------------------|
| **ToFirewall**| `0.0.0.0/0`      | Virtual Appliance    | `10.0.1.4` (Firewall IP). |
| **ToOnPremises** | `192.168.1.0/24` | Virtual Network Gateway | N/A (VPN Gateway). |
| **DropTraffic** | `10.0.2.0/24`    | None                 | N/A.               |

---

# IP Forwarding

IP forwarding allows a virtual machine (VM) to receive and send network packets not originally addressed to it. This is essential for **Network Virtual Appliances (NVAs)** like firewalls or routers.

---

## Key Concepts

| Concept              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **IP Forwarding**    | Enables a VM to handle traffic not destined for its own IP.                 |
| **Use Case**         | Required for NVAs to route traffic between subnets or to the Internet.      |
| **Configuration**    | Enabled on the VM’s network interface (NIC).                                |

---

## Steps to Enable IP Forwarding

1. **Navigate to Azure Portal:**
   - Open the VM’s **Network Interface (NIC)**.
2. **Enable IP Forwarding:**
   - Under **Settings**, click **IP Configurations**.
   - Set **IP Forwarding** to **Enabled**.
3. **Save Changes:**
   - Click **Save** to apply the configuration.

---

## Route Precedence

Azure applies routing rules in a specific order when multiple routes match a packet’s destination IP.

### Route Precedence Order
1. **User-Defined Routes (UDRs):**
   - Custom routes defined in route tables.
2. **System Routes:**
   - Default routes for intra-VNet, VNet peering, and service endpoints.
3. **BGP Routes:**
   - Routes learned via Border Gateway Protocol (BGP).
4. **Other System Routes:**
   - Default routes for Internet and on-premises traffic.

---

## Longest Prefix Match

Within a route table, the most specific route (longest prefix match) is selected. For example:

- `10.10.0.0/16` vs. `10.10.30.0/28`: Traffic to `10.10.30.4` matches the `/28` rule.

---

## Forced Tunneling

Forced tunneling routes all Internet-bound traffic (`0.0.0.0/0`) through an on-premises network via a VPN gateway.

---

## Key Takeaways

| Aspect              | Details                                                                 |
|---------------------|-------------------------------------------------------------------------|
| **IP Forwarding**   | Enables NVAs to route traffic not destined for their own IP.            |
| **Route Precedence**| UDRs > System Routes > BGP Routes > Other System Routes.                |
| **Longest Prefix Match** | The most specific route is selected.                                |
| **Forced Tunneling**| Routes all Internet traffic through an on-premises network.             |

---

# Service Endpoints

Service endpoints provide secure, direct connectivity to Azure PaaS services over the Azure backbone network, bypassing the public Internet.

---

## Key Features

| Feature              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Supported Services** | Azure Storage, SQL, Cosmos DB, Key Vault, Service Bus, Event Hubs, etc.   |
| **Secure Connectivity** | Traffic flows over Azure’s private network, not the Internet.             |
| **Subnet-Level**     | Service endpoints are enabled at the subnet level.                          |

---

## Steps to Configure Service Endpoints

1. **Navigate to Azure Portal:**
   - Open the **Virtual Network → Click Service Endpoints** under **Settings**.
2. **Add Service Endpoint:**
   - Click **+ Add → Select the service** (e.g., `Microsoft.Storage`).
   - Choose the **Subnet** (e.g., `Apps`).
   - Click **Add** to enable the service endpoint.
3. **Verify Configuration:**
   - Ensure the service endpoint is listed under **Service Endpoints**.

---

# Private Endpoints

Private endpoints provide private connectivity to Azure PaaS services by assigning a private IP address from your VNet.

---

## Key Features

| Feature              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Private IP Address** | Assigns a private IP from your VNet to the PaaS service.                   |
| **Private Link**     | Establishes secure connectivity between your VNet and the service.          |
| **Approval Workflow** | Requires consent from the service owner.                                   |

---

## Steps to Configure Private Endpoints

1. **Navigate to Azure Portal:**
   - Click **+ Create a Resource → Search for Private Endpoint → Click Create**.
2. **Configure Basics:**
   - **Subscription:** Select the subscription.
   - **Resource Group:** Choose or create a resource group.
   - **Name:** Provide a unique name for the private endpoint.
   - **Region:** Select the Azure region.
3. **Configure Resource:**
   - **Resource Type:** Select the service (e.g., `Microsoft.Web/sites` for a web app).
   - **Resource:** Choose the specific resource (e.g., your web app).
   - **Target Sub-Resource:** Select the sub-resource (e.g., `sites`).
4. **Configure Networking:**
   - **Virtual Network:** Select your VNet.
   - **Subnet:** Choose the subnet for the private endpoint.
   - **Private DNS Zone:** Enable integration if required.
5. **Review and Create:**
   - Click **Review + Create → Create** to provision the private endpoint.
  
---

# Azure DNS Overview

Azure DNS is a hosting service for DNS domains, providing name resolution for Internet-facing services. It supports both **forward** and **reverse DNS lookups**.

---

## Key Concepts

| Concept              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Domain Name**      | A name in the global DNS hierarchy (e.g., `contoso.com`).                   |
| **DNS Zone**         | A container for DNS records (e.g., `contoso.com` zone).                     |
| **Authoritative DNS** | Hosts DNS records and responds to queries for a specific domain.           |
| **Recursive DNS**    | Resolves DNS queries by querying authoritative servers (e.g., ISP DNS servers). |
| **Forward DNS**      | Maps domain names to IP addresses (e.g., `www.contoso.com` → `1.2.3.4`).    |
| **Reverse DNS**      | Maps IP addresses to domain names (e.g., `1.2.3.4` → `www.contoso.com`).    |

---

## How DNS Works

1. **DNS Query:**
   - A device queries a recursive DNS server (e.g., ISP DNS).
2. **Recursive Resolution:**
   - The recursive server queries authoritative servers (root → TLD → domain).
3. **Response:**
   - The authoritative server returns the IP address for the domain.
4. **Caching:**
   - Recursive servers cache responses based on TTL (Time-to-Live).

---

## Steps to Configure Azure DNS

### 1. Create a DNS Zone
1. **Navigate to Azure Portal:**
   - Click **+ Create a Resource → Networking → DNS Zone**.
2. **Configure Basics:**
   - **Name:** Enter the domain name (e.g., `contoso.com`).
   - **Resource Group:** Choose or create a resource group.
   - **Location:** Select the Azure region.
3. **Create:**
   - Click **Create** to provision the DNS zone.

### 2. Add DNS Records
1. **Open the DNS Zone:**
   - Navigate to the DNS zone and click **+ Record Set**.
2. **Configure Record:**
   - **Name:** Enter the subdomain (e.g., `www`).
   - **Type:** Choose the record type (e.g., A, CNAME, MX).
   - **TTL:** Set the Time-to-Live (e.g., `3600` seconds).
   - **IP Address/Value:** Enter the target IP or domain.
3. **Save:**
   - Click **OK** to add the record.

### 3. Delegate the Domain
1. **Update Name Servers:**
   - Copy the Azure DNS name servers from the DNS zone.
2. **Configure at Registrar:**
   - Log in to your domain registrar and update the NS records to point to Azure DNS.

### 4. Configure Reverse DNS (Optional)
1. **Navigate to Public IP:**
   - Open the public IP resource in Azure.
2. **Enable Reverse DNS:**
   - Under **Settings**, click **Configuration**.
   - Enable **Reverse DNS Lookup** and enter the FQDN (e.g., `www.contoso.com`).
3. **Save:**
   - Click **Save** to apply the configuration.

---

## Key Takeaways

| Aspect              | Details                                                                 |
|---------------------|-------------------------------------------------------------------------|
| **DNS Zone**        | Hosts DNS records for a domain (e.g., `contoso.com`).                   |
| **DNS Records**     | Define mappings (e.g., A records for IPs, CNAME for aliases).           |
| **Domain Delegation** | Update NS records at the registrar to point to Azure DNS.             |
| **Reverse DNS**     | Maps IPs to domain names (e.g., `1.2.3.4` → `www.contoso.com`).         |

---

## Visual Representation

### DNS Resolution Process
1. **Device → Recursive DNS Server → Root Server → TLD Server → Authoritative Server.**
2. **Response → Recursive Server → Device.**

---

# DNS Services in Azure

Azure provides several DNS-related services and features to manage domain name resolution for both Internet-facing and internal resources.

---

## Key DNS Services

| Service                  | Description                                                                 |
|--------------------------|-----------------------------------------------------------------------------|
| **Azure DNS**            | Hosts DNS zones and records for Internet-facing domains.                    |
| **Azure Traffic Manager** | Provides global traffic management using DNS-based load balancing.          |
| **App Service Domains**  | Allows purchasing and managing domain names for Azure services.             |
| **Azure-Provided DNS**   | Internal DNS for VMs in a VNet to resolve each other by hostname.           |
| **Recursive DNS**        | Resolves DNS queries for Azure VMs (can be replaced with custom DNS servers). |
| **Reverse DNS**          | Maps public IP addresses to domain names.                                   |

---

## Azure DNS

Azure DNS is a hosting service for DNS domains, providing authoritative name resolution for Internet-facing services.

### Key Features
- **Public DNS Zones:** Host DNS records for Internet-facing domains.
- **Private DNS Zones:** Host DNS records for internal VNet resources (preview).
- **Alias Records:** Automatically update DNS records when referenced resources change.

---

### Supported DNS Record Types

| Record Type | Description                                                                 |
|-------------|-----------------------------------------------------------------------------|
| **A**       | Maps a name to an IPv4 address.                                             |
| **AAAA**    | Maps a name to an IPv6 address.                                             |
| **CNAME**   | Maps a name to another domain name.                                         |
| **MX**      | Specifies mail servers for the domain.                                      |
| **NS**      | Specifies name servers for the domain.                                      |
| **TXT**     | Stores text records (e.g., SPF for email).                                  |
| **Alias**   | References other Azure resources (e.g., public IPs, Traffic Manager).       |

---

## Best Practices

- **Use Azure DNS for Reliable Hosting:**
  - Host DNS zones in Azure for high availability and performance.
- **Leverage Alias Records:**
  - Automatically update DNS records when referenced resources change.
- **Plan DNS Records Carefully:**
  - Define A, CNAME, MX, and other records as needed.
- **Delegate Domains Properly:**
  - Ensure NS records point to Azure DNS for seamless resolution.
 
  ---

  # Custom DNS Settings Overview

Azure VMs use Azure-provided DNS by default, but you can configure custom DNS settings to use your own DNS servers for advanced scenarios like cross-VNet resolution, on-premises integration, or Active Directory.

---

## Key Concepts

| Concept              | Description                                                                 |
|----------------------|-----------------------------------------------------------------------------|
| **Azure-Provided DNS** | Default DNS service for VMs in a VNet (IP: `168.63.129.16`).               |
| **Custom DNS**       | Use your own DNS servers for advanced name resolution scenarios.            |
| **DNS Suffix**       | Automatically assigned by Azure (e.g., `internal.cloudapp.net`).            |
| **Dynamic DNS**      | Allows VMs to register their hostnames with custom DNS servers.             |

---

## Steps to Configure Custom DNS

### 1. Configure DNS at the VNet Level
1. **Navigate to Azure Portal:**
   - Open the **Virtual Network → Click DNS Servers** under **Settings**.
2. **Set Custom DNS:**
   - Select **Custom** and enter the IP addresses of your DNS servers.
3. **Save Changes:**
   - Click **Save** to apply the DNS settings.

### 2. Configure DNS at the NIC Level
1. **Navigate to Azure Portal:**
   - Open the VM’s **Network Interface (NIC)**.
2. **Set Custom DNS:**
   - Under **Settings**, click **DNS Servers**.
   - Select **Custom** and enter the IP addresses of your DNS servers.
3. **Save Changes:**
   - Click **Save** to apply the DNS settings.

### 3. Restart VMs
- **VNet-Level Changes:** Restart all affected VMs manually.
- **NIC-Level Changes:** VMs restart automatically.

---

## Key Takeaways

| Aspect              | Details                                                                 |
|---------------------|-------------------------------------------------------------------------|
| **Azure-Provided DNS** | Default DNS for VMs in a VNet (IP: `168.63.129.16`).                  |
| **Custom DNS**      | Use your own DNS servers for advanced scenarios.                        |
| **DNS Suffix**      | Automatically assigned (e.g., `internal.cloudapp.net`).                |
| **Dynamic DNS**     | Allows VMs to register hostnames with custom DNS servers.               |

---

## Visual Representation

### Custom DNS Workflow
1. **Configure DNS:**
   - **VNet Level:** Set DNS servers for all VMs in the VNet.
   - **NIC Level:** Set DNS servers for individual VMs.
2. **Restart VMs:**
   - **VNet-Level:** Restart manually.
   - **NIC-Level:** Restart automatically.

---

## Custom DNS Use Cases

| Scenario                | Solution                                                                 |
|-------------------------|-------------------------------------------------------------------------|
| **Cross-VNet Resolution** | Use custom DNS servers to resolve names across VNets.                   |
| **On-Premises Integration** | Point DNS to on-premises servers for hybrid environments.              |
| **Active Directory**    | Use custom DNS for AD domain resolution.                                 |

---

## Best Practices

- **Use Custom DNS for Advanced Scenarios:**
  - Configure custom DNS for cross-VNet, on-premises, or AD integration.
- **Restart VMs After DNS Changes:**
  - Ensure VMs pick up new DNS settings by restarting them.
- **Leverage Dynamic DNS:**
  - Allow VMs to register their hostnames with custom DNS servers.
- **Plan DNS Suffix Configuration:**
  - Use startup scripts to configure DNS suffixes for Dynamic DNS registration.
 
---

# Configure Private DNS Zones

---

## Key Concepts

### Purpose of Private DNS Zones:
- Azure DNS supports private DNS domains for name resolution within and between virtual networks (VNets).
- Allows custom domain names (e.g., `mycompany.internal`) instead of Azure-provided DNS suffixes.
- Eliminates the need to run your own DNS servers.

### Automatic vs. Manual Registration:
- **Automatic Registration:** VMs in a registration VNet are automatically registered in the private DNS zone.
  - Only one VNet can be a registration VNet.
- **Manual Registration:** VMs in other VNets must be registered manually or via automation.

### Resolution VNets:
- VNets that resolve names using the private DNS zone are called **resolution VNets**.
- Name resolution works independently of VNet peering or connections.

### DNS Queries:
- Zone names are not automatically registered as DNS search suffixes on VMs.
- Use fully qualified domain names (FQDNs) or manually configure the DNS suffix.

---

## Steps to Create a Private DNS Zone (Azure Portal)

1. **Navigate to Private DNS Zone:**
   - Go to **+Create a Resource > Networking > Private DNS Zone**.
2. **Configure Settings:**
   - **DNS Domain Name:** Name of the DNS zone (e.g., `mycompany.internal`).
   - **Resource Group:** Select or create a resource group.
3. **Create Virtual Network Link:**
   - Go to **Virtual Network Links > + Add**.
   - Provide:
     - **Link Name:** Name for the link.
     - **Subscription:** Select the subscription.
     - **Virtual Network Name:** Choose the VNet.
     - **Enable Auto Registration:** Automatically registers VMs in the DNS zone.

---

## Key Points to Remember

- **Registration VNet:** Only one VNet can auto-register VMs.
- **Resolution VNets:** Multiple VNets can resolve names without needing VNet peering.
- **FQDN Usage:** Always use FQDNs or manually configure DNS suffixes for queries.
- **Automation:** Use PowerShell or Azure CLI for advanced automation.

---
